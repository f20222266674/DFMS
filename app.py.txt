from flask import Flask, render_template, request, redirect
from database import db_session
from models import Animal, MilkProduction, FeedInventory

app = Flask(__name__)

@app.route('/')
def index():
    animals = Animal.query.all()
    milk_stats = MilkProduction.query.all()
    feed_inventory = FeedInventory.query.all()
    return render_template('dashboard.html', animals=animals, milk_stats=milk_stats, feed_inventory=feed_inventory)

@app.route('/add_animal', methods=['POST'])
def add_animal():
    name = request.form.get('name')
    breed = request.form.get('breed')
    new_animal = Animal(name=name, breed=breed)
    db_session.add(new_animal)
    db_session.commit()
    return redirect('/')

@app.route('/add_milk', methods=['POST'])
def add_milk():
    animal_id = request.form.get('animal_id')
    quantity = request.form.get('quantity')
    new_milk = MilkProduction(animal_id=animal_id, quantity=quantity)
    db_session.add(new_milk)
    db_session.commit()
    return redirect('/')

@app.route('/add_feed', methods=['POST'])
def add_feed():
    feed_type = request.form.get('feed_type')
    quantity = request.form.get('quantity')
    new_feed = FeedInventory(feed_type=feed_type, quantity=quantity)
    db_session.add(new_feed)
    db_session.commit()
    return redirect('/')

if __name__ == "__main__":
    app.run(debug=True)
